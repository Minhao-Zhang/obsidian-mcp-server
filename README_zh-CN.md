# Obsidian MCP 服务器

English | [中文文档（机翻）](README_zh-CN.md)

此 Obsidian 插件运行一个本地 MCP（模型上下文协议）服务器，允许外部应用程序（如 AI 助手、脚本或其他工具）通过标准化接口与您的 Obsidian 知识库交互。

这是一个开发中的插件，虽然功能可用，但可能存在错误或不完整的功能。请报告您遇到的任何问题。我对 TypeScript 不太熟悉，因此可能存在安全和可靠性问题。您可以通过在 GitHub 上提交问题或拉取请求来帮助改进。我会尽快回应。

## 功能

- **本地 MCP 服务器**：在可配置端口上运行基于 SSE 的 MCP 服务器。
- **语义搜索的知识库索引**：
  - 将您的 Markdown 笔记内容索引到 Orama 向量数据库中。
  - 使用可配置的 OpenAI 兼容嵌入模型（例如 OpenAI，通过兼容端点的本地 Ollama 模型）生成嵌入。
  - 允许配置文本分块参数（大小、重叠、分隔符）。
  - 支持使用 `.gitignore` 语法排除特定文件或模式不被索引。
- **Obsidian 集成**：
  - **命令**：在 Obsidian 命令面板中提供以下命令：
    - 启动/停止 MCP 服务器。
    - 重新索引整个知识库（可能耗时且根据嵌入提供者可能产生费用）。
    - 手动保存向量数据库索引。
  - **设置选项卡**：提供专用设置面板配置：
    - 服务器端口和自动启动行为。
    - 嵌入提供者详情（API 端点、模型名称、API 密钥）。
    - 索引排除的文件模式。
    - 分块参数。
    - 嵌入提供者的连接验证。
  - **功能区图标**：在 Obsidian 功能区添加状态图标，显示 MCP 服务器是否正在运行。
  - **国际化**：根据 Obsidian 的语言设置支持英文和中文界面。

## MCP 工具

- `simple_vector_search`：使用向量嵌入进行笔记的语义搜索。
- `count_entries`：计算 Orama 数据库中的索引笔记和分块数量。
- `list_files`：列出指定目录中的文件和文件夹。
- `read_file`：读取特定文件的内容。
- `create_file`：创建新文件。
- `edit_file`：编辑现有文件中特定范围的行。
- `delete_file`：删除文件。
- `create_folder`：创建文件夹。
- `delete_folder`：删除文件夹。

## 待办事项

- [x] 多语言支持（英文、中文）
- [x] 提供基本的文件/文件夹操作工具（创建、读取、编辑、删除）
- [ ] 添加基于 Obsidian 模板生成笔记的工具
- [ ] 实现按元数据（frontmatter）过滤的搜索
- [ ] 实现新笔记和编辑的实时跟踪和更新

## 配置

在 Obsidian 中访问插件设置以配置：

1. **服务器设置**：端口号以及服务器是否应随 Obsidian 自动启动。
2. **嵌入模型**：提供您选择的 OpenAI 兼容嵌入提供者的 URL、模型名称和 API 密钥。使用提供的按钮验证连接。
3. **向量存储**：
    - 定义文件模式（如 `.gitignore`）以排除特定文件或文件夹不被索引。您可以直接从知识库的 `.gitignore` 文件中复制模式。
    - 如果需要，调整分块参数（大小、重叠、分隔符），尽管默认值通常适用。
4. **MCP 工具**：通过设置中的开关启用或禁用服务器提供的*单个*工具（如 `read_file`、`create_folder` 等）。需要重新启动服务器（使用设置中的按钮）才能使更改生效。

## 使用方法

1. **配置**：通过 Obsidian 设置面板设置插件，特别是嵌入模型详情。
2. **索引知识库**：从 Obsidian 命令面板运行"重新索引知识库（MCP 服务器）"命令。这是 `simple_vector_search` 工具正常工作所必需的。等待索引过程完成（将出现通知）。
3. **启动服务器**：确保 MCP 服务器正在运行。在设置中启用"自动启动 MCP"或使用"启动 MCP 服务器"命令。
4. **连接外部工具**：将您的 MCP 客户端（例如配置为使用 MCP 的 AI 助手）连接到设置中显示的服务器端点（例如 `http://localhost:8080/sse`）。
5. **使用工具**：从连接的客户端使用可用的 MCP 工具（`simple_vector_search`、`list_files`、`read_file` 等）与您的 Obsidian 知识库交互。
6. 在您喜欢的支持 MCP 的客户端中，将 MCP 配置为 SSE 模式并将端点设置为 `http://localhost:8080/sse`（或您配置的端口）。然后您可以使用此插件公开的工具。
7. **停止服务器**：不使用时使用"停止 MCP 服务器"命令停止服务器。

## 开发

此项目使用 TypeScript。确保您已安装 Node.js 和 npm。

1. 克隆仓库。
2. 运行 `npm install` 安装依赖项。
3. 运行 `npm run dev` 编译插件并监视更改。
4. 将 `main.js`、`manifest.json` 和 `styles.css` 文件复制到您的 Obsidian 知识库的 `.obsidian/plugins/mcp-server/` 目录中。
5. 重新加载 Obsidian 并启用插件。

## 已知问题和限制

1. **文件大小限制**：如果您的知识库包含许多笔记，当 `orama.json` 文件超过 512MB 时，索引可能会失败。目前除了减少笔记/分块数量外没有解决方法。

2. **数字存储**：OramaDB 将浮点数存储为原始字符串，这会迅速增加数据库大小。
